{"version":3,"sources":["src/index.js"],"names":["ExpressApp","config","title","version","port","logger","console","write","log","routes","undefined","publicDirectory","start","process","env","NODE_ENV","workerTask","masterTask","cluster","isMaster","started","Array","os","cpus","length","fill","forEach","fork","on","worker","info","id","address","app","use","express","json","urlencoded","extended","path","join","__dirname","stream","req","res","next","header","server","listen","PORT","setTimeout","Object","assign","module","exports"],"mappings":"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","sourcesContent":["\nimport express from 'express'\nimport path from 'path'\nimport cookieParser from 'cookie-parser'\nimport morgan from 'morgan'\nimport cluster from 'cluster'\nimport os from 'os'\n\n/** ExpressApp Class to create and start an Express Application */\nclass ExpressApp {\n  config = {\n    title: 'ExpressApp',\n    version: '',\n    port: 3000,\n    logger: {...console, write: console.log},\n    routes: undefined,\n    publicDirectory: 'public'\n  }\n\n  /**\n   * Constructor\n   * @param {{\n   *     title: string,\n   *     version: string,\n   *     port: number,\n   *     logger: {\n   *         write: (message?: any, ...optionalParams: any[]): void,\n   *         info: (message?: any, ...optionalParams: any[]): void,\n   *         error: (message?: any, ...optionalParams: any[]): void,\n   *         debug: (message?: any, ...optionalParams: any[]): void,\n   *         warn: (message?: any, ...optionalParams: any[]): void\n   *     };\n   *     routes: (app: express): void,\n   *     publicDirectory: string\n   * }} config \n   */\n  constructor(config){\n    Object.assign(this.config, config)\n  }\n\n  start = () => {\n    if(process.env.NODE_ENV === 'development'){\n      this.workerTask()\n      this.masterTask()\n    }\n    else {\n      if (cluster.isMaster) {\n        let started = 0\n        Array(os.cpus().length).fill().forEach(() => cluster.fork())\n        cluster.on('exit', worker => this.config.logger.info(`Module #${worker.id} has exitted.`))\n        cluster.on('online', worker => this.config.logger.info(`Start module #${worker.id}`))\n        cluster.on('listening', (worker, address) => {\n          this.config.logger.info(`Module #${worker.id} started and listening on port ${address.port}`)\n          if(++started == os.cpus().length){\n            this.masterTask()\n          }\n        })\n      } else {\n        this.workerTask()\n      }\n    }\n  }\n\n  masterTask = () => {\n    this.config.logger.info(`${this.config.title} ${this.config.version} started`)\n    this.config.logger.info(`URL : http://localhost:${this.config.port}`)\n  }\n\n  workerTask = () => {\n    var app = express()\n    app.use(\n      express.json(),\n      express.urlencoded({ extended: false }),\n      express.static(path.join(__dirname, this.config.publicDirectory)),\n      cookieParser(),\n      morgan('tiny', {stream: this.config.logger}),\n      (req, res, next) => {\n        res.header('Access-Control-Allow-Origin', '*')\n        res.header('Access-Control-Allow-Headers', '*')\n        next()\n      }\n    )\n    this.config.routes(app)\n    let server = app.listen(process.env.PORT || this.config.port)\n    server.setTimeout(500000)\n  }\n}\n\nmodule.exports = ExpressApp"],"file":"index.js"}